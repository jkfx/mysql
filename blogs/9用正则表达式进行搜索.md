# 用正则表达式进行搜索

## 使用MySQL正则表达式

### 基本字符匹配

下面的语句检索列prod_name包含文本1000的所有行：

**输入**

```mysql
SELECT prod_name
FROM products
WHERE prod_name REGEXP '1000'
ORDER BY prod_name;
```

**输出**

```mysql
+--------------+
| prod_name    |
+--------------+
| JetPack 1000 |
+--------------+
```

**分析**

出关键字LIKE被REGEXP替代外，这条语句看上去非常像LIKE的语句。它告诉MySQL：REGEXP后所跟的东西作为正则表达式（与文字正文匹配1000匹配的一个正则表达式）处理。

在上面的例子中，正则表达式确实没有带来太多好处（可能还会降低性能），不过，请考虑下面的例子：

**输入**

```mysql
SELECT prod_name
FROM products
WHERE prod_name REGEXP '.000'
ORDER BY prod_name;
```

**输出**

```mysql
+--------------+
| prod_name    |
+--------------+
| JetPack 1000 |
| JetPack 2000 |
+--------------+
```

**分析**

这里使用了正则表达式**.000。**`.`是正则表达式语言中一个特殊的字符。它表示匹配任意一个字符。

当然，这个特殊的例子也可以用LIKE和通配符来完成。

> **匹配不区分大小写** MySQL中的正则表达式匹配（自版本3.23.4后）不区分大小写（即，大写和小写都匹配）。为区分大小写，可使用BINARY关键字，如WHERE prod_name REGEXP BINARY 'JetPack .000'。

### 进行OR匹配

为搜索两个串之一（或者为这个串，或者为另一个串），使用`|`，如下所示：

**输入**

```mysql
SELECT prod_name
FROM products
WHERE prod_name REGEXP '1000|2000'
ORDER BY prod_name;
```

**输出**

```mysql
+--------------+
| prod_name    |
+--------------+
| JetPack 1000 |
| JetPack 2000 |
+--------------+
```

**分析**

语句中使用了正则表达式1000|2000。`|`为正则表达式的OR操作符。它表示匹配其中之一。

> **两个以上的OR条件** 可以给出两个以上的OR条件。例如，'1000|2000|3000'将匹配1000或2000或3000。

### 匹配几个字符之一

匹配任何单一字符。可通过指定一组用`[`和`]`括起来的字符来完成，如下所示：

**输入**

```mysql
SELECT prod_name
FROM products
WHERE prod_name REGEXP '[123] Ton'
ORDER BY prod_name;
```

**输出**

```mysql
+-------------+
| prod_name   |
+-------------+
| 1 ton anvil |
| 2 ton anvil |
+-------------+
```

**分析**

[123]定义一组字符，它的意思是匹配1或2或3。

正如所见，[]是另一种形式的OR语句。事实上，正则表达式[123] Ton为[1|2|3] Ton的缩写，也可以使用后者。但是，需要用[]来定义OR语句查找什么。为更好地理解这一点，请看下面的例子：

**输入**

```mysql
SELECT prod_name
FROM products
WHERE prod_name REGEXP '1|2|3 Ton'
ORDER BY prod_name;
```

**输出**

```mysql
+---------------+
| prod_name     |
+---------------+
| 1 ton anvil   |
| 2 ton anvil   |
| JetPack 1000  |
| JetPack 2000  |
| TNT (1 stick) |
+---------------+
```

**分析**

这里并不是期望的输出。两个要求的行被检索出来，但还检索出了另外3行。之所以这样是由于MySQL假定你的意思是'1'或'2'或'3 Ton'。除非把字符`|`括在一个集合中，否则它将应用于整个串。

字符集也可以被否定，即，它们将匹配除指定字符外的任何东西。为否定一个字符集，在集合的开始处放置一个`^`即可。因此，尽管[123]匹配字符1、2或3，但`[^123]`却匹配除这些字符外的任何东西。

### 范围匹配

集合可用来定义要匹配的一个或多个字符。例如，下面的集合将匹配数字0到9：

`[0123456789]`

为简化这种类型的集合，可使用`-`来定义一个范围。下面的式子功能上等同于上述数字列表：

`[0-9]`

范围不限于完整的集合。此外，范围不一定只是数值的，[a-z]匹配任意字母字符。

举一个例子：

**输入**

```mysql
SELECT prod_name
FROM products
WHERE prod_name REGEXP '[1-5] Ton'
ORDER BY prod_name;
```

**输出**

```mysql
+--------------+
| prod_name    |
+--------------+
| .5 ton anvil |
| 1 ton anvil  |
| 2 ton anvil  |
+--------------+
```

**分析**

这里使用正则表达式[1-5] Ton。[1-5]定义了一个范围，这个表达式意思是匹配1-5，因此返回3个匹配行。由于5 ton匹配，所以返回. 5 ton。